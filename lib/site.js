/**!
 * JavaScript for wafflesnatcha.github.com
 *
 * @author Scott Buchanan <buchanan.sc@gmail.com>
 * @link http://wafflesnatcha.github.com
 *//** @namespace */var Site=function(){var a={content_anim_duration:300,index_page:"index.html",routing:!0,title:"",url:"",tracking:!0,layout:"default",origin:location.protocol+"//"+location.host,selector_content:"#content",selector_links_all:"a",selector_links_external:['a[rel="external"]','a[href^="http://"]:not([href^="http://'+location.host+'"])"','a[href^="https://"]:not([href^="https://'+location.host+'"])'].join(","),selector_links_internal:'a[href^="/"]',template_error_page:'<div id="layout-error"><h1 class="page-title"><%status%></h1><div class="page-body"><%text%></div></div>'};return{init:function(a){if(typeof a=="object")for(var b in a)Site.config(b,a[b]);Site.UI.init(),Site.Links.init(),Site.Navigation.init()},config:function(b,c){return b?(c&&(a[b]=c),a[b]):a},loadEnd:function(){setTimeout(function(){window.scrollTo(0,0)},100)},navigate:function(a){return Site.Navigation.go(a)},setTitle:function(a){return a&&$(document).prop("title",a),$(document).prop("title")}}}();Site.Content=function(){var a,b=/<title>(.*)<\/title>/i,c=Site.config("selector_content");return{load:function(d){a&&a.abort&&a.abort();if(!d||d=="/"||d=="/"+Site.config("index_page")){Site.Content.clear();return}this.loadStart(),this.expand(),a=$(c).load(d+" #content > *",function(a,c,d){c=="error"&&Site.Content.error(d.status,d.statusText);var e=b.exec(a);e&&e.length>1&&Site.setTitle(e[1]),Site.Content.loadEnd(),$(this).text()==""?Site.Content.clear():Site.Links.init(this)})},error:function(a,b){$(c).html(Site.UI.template(Site.config("template_error_page"),{status:a,text:b}))},loadStart:function(){var a=$(c);a.addClass("loading"),Site.Links.disable(a)},loadEnd:function(){$(c).removeClass("loading"),Site.UI.refresh()},expand:function(a){var b=$("#layout"),a=a||$.noop;if(b.hasClass("expanded"))return a.apply(b);if(Site.config("layout")!="default")return b.removeClass("collapsed").addClass("expanded"),a.apply(b);b.width(b.width()).removeClass("collapsed"),b.animate({width:"+="+$(c).outerWidth()},{duration:Site.config("content_anim_duration"),complete:function(){$(this).addClass("expanded").removeClass("collapsed"),a.apply(this)}})},collapse:function(a){var b=$("#layout"),a=a||$.noop;if(!b.hasClass("expanded")||b.hasClass("collapsed"))return a.apply(this);if(Site.config("layout")!="default")return b.removeClass("expanded").addClass("collapsed"),a.apply(b);b.width(b.width()).removeClass("expanded"),b.animate({width:"-="+$(c).outerWidth()},{duration:Site.config("content_anim_duration"),complete:function(){$(this).addClass("collapsed").removeClass("expanded"),a.apply(this)}})},clear:function(){Site.Content.collapse(function(){$(c).empty(),Site.setTitle(Site.config("title")),Site.Content.loadEnd()})}}}(),Site.Links=function(){var a={all:Site.config("selector_links_all"),external:Site.config("selector_links_external"),internal:Site.config("selector_links_internal")};return{init:function(b){$(a.external,b||document.body).attr("target","_blank").addClass("link-external"),$(a.internal,b||document.body).addClass("link-internal"),Site.config("routing")&&this.startRouting(b)},startRouting:function(b){$(a.all,b||document.body).on("click",function(a){if(a.which&&a.which!=1||a.metaKey||a.ctrlKey||a.shiftKey||a.altKey)return;Site.navigate(this)&&a.preventDefault()})},stopRouting:function(b){$(a.internal,b||document.body).off("click")},disable:function(b){var c=$(a.all,b||document.body);c.off("click").on("click",function(a){a.preventDefault()}),c.each(function(a,b){$(b).removeAttr("href")})}}}(),Site.Links=function(){var a={all:Site.config("selector_links_all"),external:Site.config("selector_links_external"),internal:Site.config("selector_links_internal")};return{init:function(b){$(a.external,b||document.body).attr("target","_blank").addClass("link-external"),$(a.internal,b||document.body).addClass("link-internal"),Site.config("routing")&&this.startRouting(b)},startRouting:function(b){$(a.all,b||document.body).on("click",function(a){if(a.which&&a.which!=1||a.metaKey||a.ctrlKey||a.shiftKey||a.altKey)return;Site.navigate(this)&&a.preventDefault()})},stopRouting:function(b){$(a.internal,b||document.body).off("click")},disable:function(b){var c=$(a.all,b||document.body);c.off("click").on("click",function(a){a.preventDefault()}),c.each(function(a,b){$(b).removeAttr("href")})}}}(),Site.Navigation=function(){function b(a,b){if(!Site.config("tracking")||!_gaq)return!1;a||b?_gaq.push(["_trackEvent",a||"",b||""]):_gaq.push(["_trackPageview"])}function c(b){return!a.history&&!a.hashchange?(location.href=b,!1):(Site.Content.load(b),!0)}function d(a,c){var c=c||!1;b("Outbound Link",a),c&&setTimeout(function(){location.href=a},100)}function e(b,c){if(a.history){var d=[{url:b},"page",b];c||b==window.location.href||b==window.location.pathname?window.history.replaceState.apply(window.history,d):window.history.pushState.apply(window.history,d)}else a.hashchange&&(location.href="/#"+b)}var a={history:window.history&&window.history.pushState,hashchange:!1};return{init:function(){Site.Navigation.go(window.location.href,!1),a.history?window.onpopstate=function(a){a.state&&a.state.url?Site.Navigation.go(a.state.url,!0):e(window.location.pathname+window.location.hash,!0)}:a.hashchange&&(window.onhashchange=function(a){Site.Navigation.go(window.location,!0)})},go:function(a,f){var f=f||!1,g,h;typeof a=="object"&&(h=a,a=$(h).attr("href"),g=$(h).attr("target"));if(g&&g!="_self")return d(a,!1),!1;var i=Site.config("origin");a.substr(0,i.length)==i&&(a=a.substr(i.length));var j=a.split("/#/");return j.length==2&&j[0]==""&&(a="/"+j[j.length-1],f=!0),!!f||a!=window.location.href&&a!=window.location.pathname?(a.charAt(0)!="/"?d(a,!0):(c(a),e(a,f),b()),!0):a.indexOf("#")>=0?!1:!0}}}(),Site.UI=function(){return{init:function(){Modernizr.mq("only all and (max-device-width: 900px)")&&Site.config("layout","narrow"),$(document.body).addClass("layout-"+Site.config("layout")),jQuery().tipsy&&$("#navigation .my-links a").tipsy({delayIn:0,delayOut:0,fade:!1,fallback:"",gravity:"n",html:!1,live:!1,offset:2,opacity:1,title:"title",trigger:"hover"}),Site.UI.refresh()},refresh:function(){setTimeout(function(){window.scrollTo(0,0)},200)},template:function(a,b){var c,d=a,b=b||{};for(c in b)d=d.replace("<%"+c+"%>",b[c]);return d=d.replace(/<%[a-z_\-0-9]+%>/ig,""),d}}}(),jQuery(function(){Site.init({title:"{{ site.title }}",url:"{{ site.url }}"})});